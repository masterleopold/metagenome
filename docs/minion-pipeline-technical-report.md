# MinIONメタゲノム病原体スクリーニングパイプライン - 技術調査報告書

**調査日**: 2025年11月10日
**プロジェクト**: 異種移植用ドナーブタの病原体メタゲノム解析体制
**対象**: PMDA指定91病原体スクリーニングシステム

---

## 目次

1. [サンプル前処理戦略](#1-サンプル前処理戦略)
2. [解析パイプラインアーキテクチャ](#2-解析パイプラインアーキテクチャ)
3. [変異体検出機能](#3-変異体検出機能)
4. [データ保持と再解析機能](#4-データ保持と再解析機能)
5. [血漿量要件と検出感度](#5-血漿量要件と検出感度)
6. [推奨事項と今後の展開](#6-推奨事項と今後の展開)

---

## 1. サンプル前処理戦略

### 1.1 PCR増幅の要否

**結論**: **PCR増幅は不要**（意図的な設計選択）

#### 1.1.1 採用されている方法

**DNA用ライブラリ調製**:
- **キット**: Oxford Nanopore SQK-LSK114（Ligation Sequencing Kit）
- **方式**: ライゲーション（増幅なし）
- **プロトコル**: DNA修復 → 末端処理 → dA-tailing → アダプターライゲーション

**RNA用ライブラリ調製**:
- **キット**: NEBNext Ultra II Directional RNA Library Prep + SQK-LSK114
- **方式**: PCRフリープロトコル
- **プロトコル**: cDNA合成 → 直接ライブラリ調製

#### 1.1.2 シーケンシング方法の比較

| 方法 | リード長 | 精度 | 採用状況 | バイアス |
|------|---------|------|---------|---------|
| **ライゲーション** | 5-50 kb | Q30標準 | ✓ **主要採用** | 最小 |
| PCRフリー | 10-100 kb | Q30+ | バックアップ | 最小 |
| PCR増幅 | 0.5-5 kb | Q20-Q30 | **最終手段のみ** | 高い |

#### 1.1.3 PCRを使わない理由

**技術的理由**:
1. **ロングリード維持**: PERV完全ゲノム（8-9 kb）を1リードでカバー可能
2. **バイアス回避**: PCR増幅による配列特異的増幅偏りを防止
3. **定量精度**: GC含量バイアスなしで正確なコピー数算出
4. **メタゲノム適性**: 91種類の多様な病原体を均等に検出

**運用的理由**:
5. **コスト効率**: PCR試薬・サイクル時間が不要
6. **ターンアラウンド短縮**: ライブラリ調製が3-4時間短縮
7. **規制準拠**: PCRフリー法は再現性が高くPMDA審査に有利

#### 1.1.4 PCRが言及される例外的状況

**低収量時のトラブルシューティング**（Protocol 05, Section 9.1）:

```yaml
ライブラリ収量 <50 ng の場合:
  状態: "不足、PCR増幅検討（非推奨）"
  推奨対策:
    - Option B: バーコード化による複数サンプルプーリング（推奨）
    - PCR増幅: 最終手段（非推奨）
  PCR使用時の制約:
    - サイクル数: <12 cycles（バイアス最小化）
    - リード長: 0.5-5 kb に制限
    - 定量精度: 低下
```

---

### 1.2 病原体タイプ別前処理の要否

**結論**: **病原体別の前処理工夫は不要**（戦略的ユニバーサルアプローチ）

#### 1.2.1 PMDA 91病原体の多様性

**内訳**:
- ウイルス（45種）: DNA/RNAウイルス
- 細菌（35種）: グラム陽性/陰性、抗酸菌等
- 寄生虫（5種）: 原虫、蠕虫
- 真菌（5種）: 酵母、糸状菌
- プリオン（1種）: 伝達性海綿状脳症病原体

#### 1.2.2 単一プロトコルによる普遍的カバレッジ

**Protocol 03（cfDNA/cfRNA抽出）の性能**:

| 病原体タイプ | 核酸サイズ範囲 | ビーズ吸着効率 | 特別処理 |
|------------|--------------|--------------|---------|
| DNAウイルス | 3-200 kb | 95-99% | なし |
| RNAウイルス | 0.5-30 kb | 90-98% | なし |
| 細菌DNA断片 | 100 bp-10 kb | 95-99% | なし |
| 真菌DNA断片 | 100 bp-10 kb | 95-99% | なし |
| 原虫DNA断片 | 100 bp-10 kb | 95-99% | なし |
| PERV（DNA/RNA） | 8-9 kb | 98-99% | なし |

**使用キット**: Zymo Research Quick-cfDNA/cfRNA™ Kit
- **機構**: 磁気ビーズによる普遍的核酸捕捉（配列非特異的）
- **カオトロピック塩**: グアニジウムチオシアネートで細胞/タンパク質溶解
- **シリカビーズ**: 静電相互作用ですべてのDNA/RNAを捕捉

#### 1.2.3 宿主DNA除去の普遍性

**Protocol 04（NEBNext Microbiome DNA Enrichment）のメカニズム**:

**CpGメチル化率による選択的除去**:

| DNA種類 | CpGメチル化率 | CXXC結合 | 除去率 | 回収率 |
|---------|-------------|----------|--------|--------|
| ブタ（宿主）DNA | 70-80% | ✓✓✓ 強 | 95-99% | 1-5% |
| 細菌DNA | <5% | ❌ なし | <5% | >95% |
| ウイルスDNA | 0-5% | ❌ なし | <5% | >95% |
| 真菌DNA | 5-15% | △ 弱 | 10-20% | 80-90% |
| 原虫DNA | 10-30% | △ 中 | 20-40% | 60-80% |

**重要な設計思想** (Protocol 04, Section 2.1より):
> 「真菌・原虫は細菌・ウイルスより若干メチル化率が高いが、宿主DNA（70-80%）と比較すると遥かに低いため、相対的エンリッチメントが達成される。一部の回収ロスは、宿主DNA圧倒的多数（99.9%）の除去による10倍濃縮効果で補償される。」

---

### 1.3 キャプチャプローブ使用の有無

**結論**: **キャプチャプローブは使用せず、ショットガンメタゲノミクスを採用**

#### 1.3.1 磁気ビーズの実際の用途

**3つの異なる磁気ビーズ、すべて非ハイブリダイゼーション**:

| ステップ | ビーズタイプ | 機能 | メカニズム | 配列特異性 |
|---------|------------|------|-----------|-----------|
| **抽出** | Zymo MagBinding Beads | 普遍的核酸捕捉 | シリカ表面静電結合 | ❌ なし |
| **宿主除去** | Protein A Magnetic Beads | メチル化DNA除去 | MBD2-Fc-DNA複合体捕捉 | ❌ なし（エピジェネティック選択） |
| **クリーンアップ** | AMPure XP Beads | サイズ選択 | PEG濃度依存結合 | ❌ なし |

#### 1.3.2 ショットガン vs キャプチャプローブの比較

**コスト・手間分析** (NGS全量解析vs従来法ハイブリッド戦略_コスト・手間分析.md):

| 項目 | Pattern A: NGS全量（採用） | Pattern B: ハイブリッド（不採用） |
|------|-------------------------|---------------------------|
| **アプローチ** | ショットガンメタゲノミクス | NGS + 従来法 + キャプチャ |
| **プローブ使用** | なし | あり（91種カスタムパネル） |
| **コスト/サンプル** | ¥162,574 | ¥449,574（2.8倍） |
| **処理時間** | 3-5日 | 7-10日 |
| **ハンズオン** | 20時間 | 72時間 |
| **91病原体カバレッジ** | 100%（単一反応） | 部分的（5種類の手法必要） |
| **未知変異株** | 検出可能 | 検出困難（プローブ外） |
| **PMDA準拠** | 完全準拠 | 部分準拠（追加検証必要） |

---

## 2. 解析パイプラインアーキテクチャ

### 2.1 全体構成

**実行モデル**: Lambda → EC2カスタムAMI → 自動終了（Dockerレス）

**使用AWSサービス**:
- **Lambda**: オーケストレーション（Python 3.11、512MB-1GB RAM）
- **EC2**: 計算ワークロード（カスタムAMI、スポット優先）
- **Step Functions**: ワークフロー制御（標準ワークフロー）
- **EFS**: 共有データベース（Kraken2、BLAST、PMDA）
- **S3**: データストレージ（ライフサイクル管理）
- **RDS**: メタデータ・実行履歴（PostgreSQL 14）
- **SNS**: アラート通知（PERV検出、エラー）
- **CloudWatch**: ログ・メトリクス

---

### 2.2 6フェーズ詳細

#### Phase 1: Basecalling（ベースコール）

**処理内容**:
- FAST5/POD5 → FASTQ変換
- Dorado duplex basecalling（Q30精度）
- インスタンス: g4dn.xlarge（GPU、NVIDIA T4 × 2）
- 最小Qスコア: 9
- タイムアウト: 12時間
- スポットインスタンス優先（70%コスト削減）

#### Phase 2: Quality Control（品質管理）

**処理内容**:
- NanoPlot、PycoQCによる品質評価
- インスタンス: m5.xlarge

**合格基準**:
- 総リード数 ≥ 10,000,000
- Q30リード率 ≥ 85%
- 平均Qスコア ≥ 9

#### Phase 3: Host Removal（宿主DNA除去）

**処理内容**:
- Minimap2でSus scrofa 11.1ゲノムにアライメント
- インスタンス: r5.2xlarge（64GB RAM）
- 宿主マッチ: ≥90%同一性
- 目標除去率: >90%

#### Phase 4: Pathogen Detection（病原体検出）⭐ 最重要フェーズ

**インスタンス**: r5.4xlarge（128GB RAM）

**4つの並列検出システム**:

##### 4-1. Kraken2分類（迅速分類）
- 信頼度閾値: 0.05（5%）
- Brackenで種レベル定量
- ファジーマッチングでPMDA 91病原体抽出

##### 4-2. BLAST/RVDB検索（ウイルスデータベース）
- 同一性 ≥ 90%
- E-value < 1e-5
- アライメント長 ≥ 100bp

##### 4-3. PMDAターゲット検索（カスタムDB）
- Minimap2で91病原体専用データベースにアライメント
- `map-ont`プリセット（Nanopore最適化）
- リード数、平均同一性、カバレッジ幅を追跡

##### 4-4. PERV特異的解析（最優先）🚨

**検出ワークフロー**:
1. PERVリファレンスにアライメント
2. サブタイプ別に分割（PERV-A/B/C）
3. カバレッジ解析（幅80%、深度10x必要）
4. サブタイプ同定（特異的モチーフ検索）
5. 組換え体検出（キメラリード解析）
6. 系統解析（MAFFT + BioPython）
7. **SNSアラート**: PERV検出時に即座に送信

**サブタイプ特異的モチーフ**:
- PERV-A: `ATGGCAGCCACCACAGC`, `TGGAGACCTGGAAGACC`
- PERV-B: `ATGGCAACCACCGTAGC`, `TGGAAACCTGGAAAACC`
- PERV-C: `ATGGCAGCCACCATAGG`, `TGGAGACCTGGAAGAAC`

#### Phase 5: Quantification（定量）

**処理内容**:
- PhiX174スパイクイン正規化（1%濃度）
- 絶対コピー数算出
- 出力: コピー数/mL血漿

**リファレンスゲノムサイズ**:
- PERV: 8,000 bp
- ASFV: 170,000 bp
- E. coli: 5,000,000 bp
- Toxoplasma gondii: 65,000,000 bp
- （91病原体すべてに対応）

#### Phase 6: Reporting（レポート生成）

**生成レポート**:
1. **PMDA準拠PDF**: 91病原体チェックリスト、検出病原体詳細、PERV特異的セクション
2. **JSON結果ファイル**: 機械可読形式、API連携用
3. **HTMLインタラクティブレポート**: グラフ・プロット、フィルタリング機能

---

### 2.3 実行例

**Run ID**: `RUN-2024-001`、50GB MinIONデータ

| フェーズ | 所要時間 | インスタンス | コスト |
|---------|---------|------------|--------|
| Basecalling | 8-12時間 | g4dn.xlarge | $15-25 |
| QC | 2-4時間 | m5.xlarge | $3-6 |
| Host Removal | 3-6時間 | r5.2xlarge | $8-16 |
| Pathogen Detection | 4-8時間 | r5.4xlarge | $20-40 |
| Quantification | 1-2時間 | m5.2xlarge | $4-8 |
| Reporting | 30-60分 | m5.xlarge | $1-2 |
| **合計** | **20-35時間** | - | **$51-97** |

**スポットインスタンス使用時の実際のコスト**: $150-250/解析

---

## 3. 変異体検出機能

### 3.1 現在の実装状況

**結論**: **変異体検出は明示的に無効化されている**

**設定ファイル** (`default_pipeline.yaml` 183-186行目):
```yaml
advanced:
  enable_de_novo_assembly: false
  enable_variant_calling: false        # ← 無効化
  enable_methylation_analysis: false
  enable_structural_variant_detection: false
```

---

### 3.2 部分的に実装されている機能

#### 3.2.1 PERVコンセンサス配列生成（限定的）

**対象**: PERV-A/B/Cのみ（91病原体中3種）

**制限事項**:
- ツール: `bcftools call -c`（古いアルゴリズム）
- VCF出力: 中間ファイルとして生成されるが解析されない
- 変異抽出: 明示的なSNP/indel抽出なし
- 必要カバレッジ: >100リード

#### 3.2.2 PERV組換え体検出（構造変異）

**検出可能**:
- ✓ サブタイプ内組換え（PERV-A × PERV-A）
- ✓ サブタイプ間組換え（PERV-A × PERV-B）
- ✓ ブレークポイント推定位置

**検出不可**:
- ✗ 点変異（SNP）
- ✗ 短い挿入/欠失（indel）

#### 3.2.3 PERV系統解析（距離ベース分類）

- MAFFT多重配列アライメント
- 距離行列算出
- NJ法による系統樹構築
- 新規配列判定（>15%乖離）

**制限事項**: PERVのみ、距離ベースのみ（最尤法未使用）

---

### 3.3 変異検出機能の能力マトリクス

| 変異タイプ | 検出状況 | 対象病原体 | 使用ツール | 完全性 |
|-----------|---------|----------|-----------|--------|
| **SNP** | △ 部分実装 | PERVのみ | bcftools call | VCF未解析 |
| **Indel** | △ 部分実装 | PERVのみ | bcftools call | VCF未解析 |
| **構造変異** | ✓ 実装 | PERVのみ | pysam (SA tag) | 組換えのみ |
| **サブタイプ/株** | ✓ 実装 | PERVのみ | モチーフマッチ | 完全 |
| **系統クレード** | ✓ 実装 | PERVのみ | MAFFT + BioPython | 距離ベースのみ |
| **変異頻度** | ✗ 未実装 | なし | - | - |

---

### 3.4 変異検出が無効化されている理由

#### 3.4.1 カバレッジ要件

| 変異タイプ | 必要カバレッジ | MinION典型値 | 状態 |
|-----------|--------------|------------|------|
| SNP（高信頼度） | 20x+ | 10-50x | △ ギリギリ |
| Indel（高信頼度） | 40x+ | 10-50x | ✗ 不足 |
| 構造変異 | 10x+ | 10-50x | ✓ 十分 |

#### 3.4.2 PMDA規制範囲

**PMDA要件**: **存在/非存在検出**（変異キャラクタリゼーションではない）

**PMDA指針明記** (厚労省異種移植指針):
> 「ドナー動物における病原体の**検出**を目的とする。変異解析は研究目的であり、スクリーニングの必須要件ではない。」

#### 3.4.3 コスト対効果

| 項目 | 現行（変異検出なし） | 変異検出追加時 |
|------|------------------|--------------|
| 処理時間 | 20-35時間 | 24-40時間（+4-5時間） |
| 計算コスト | $150-250 | $200-350（+$50-100） |
| 年間運用 (24サンプル) | - | +$600-2,400 |

---

## 4. データ保持と再解析機能

### 4.1 データ保持ポリシー

#### 4.1.1 現在の設定

```yaml
data_retention:
  raw_data_days: 30          # FAST5/POD5
  processed_data_days: 90    # FASTQ, BAM
  reports_days: 365          # PDF, JSON, HTML
  database_records_days: 730 # RDSメタデータ
```

**重要**: これは「ホットストレージ保持期間」であり、削除期限ではない。

---

#### 4.1.2 S3ライフサイクル管理

**Raw Dataバケット（FAST5/POD5）**:

| 期間 | ストレージクラス | 状態 | 取得時間 | コスト |
|------|----------------|------|---------|--------|
| 0-90日 | S3 Standard | ホットストレージ | 即時 | $0.023/GB/月 |
| 90-365日 | Glacier IR | コールドストレージ | 数分-数時間 | $0.004/GB/月 |
| 365-1825日 | Deep Archive | 長期保管 | **12時間** | $0.00099/GB/月 |
| 1825日以降 | 削除 | PMDA 5年保持満了 | - | - |

**重要な発見**: FAST5データは**5年間保持**されており、再解析は技術的に可能。

---

### 4.2 保存されるファイル構造

**重要なファイルの保持期間**:

| ファイルタイプ | 保存場所 | ホット期間 | Glacier期間 | Deep Archive | 削除 |
|-------------|---------|-----------|------------|-------------|-----|
| FAST5 | raw-data bucket | 90日 | 90-365日 | 365-1825日 | 5年後 |
| FASTQ | analysis/basecalling/ | 90日 | 90-365日 | 365-1825日 | 5年後 |
| BAM | analysis/pathogen/ | 90日 | 90-365日 | 365-1825日 | 5年後 |
| JSON結果 | analysis/*/  | 90日 | 90-365日 | 365-1825日 | 5年後 |
| PDF Report | analysis/reports/ | 365日 | - | 365-1825日 | 5年後 |

---

### 4.3 再解析の実現可能性

#### 4.3.1 FAST5からの完全再解析

**可能性**: ✅ **技術的に可能**

**ワークフロー**:
1. Deep Archive取得リクエスト（12時間待機）
2. Phase 1から完全実行
3. 合計時間: 34-48時間（取得含む）
4. 合計コスト: $401-516

**ユースケース**:
- 新しいDoradoモデルでの再ベースコール
- シグナルレベル変異検出（Nanopolish）
- メチル化解析の実施

#### 4.3.2 FASTQからの部分再解析（推奨）

**可能性**: ✅ **最適アプローチ**

**ワークフロー**:
1. FASTQ取得（即時-数時間）
2. Phase 2（QC）から実行
3. 合計時間: 6-12時間
4. 合計コスト: $151-252

**ユースケース**:
- データベース更新後の再スクリーニング
- 変異検出パイプライン追加
- 検出閾値の変更
- **最も実用的**

#### 4.3.3 BAMファイルからの変異検出のみ

**可能性**: ✅ **最速・最安**

**ワークフロー**:
1. Phase 4 BAMファイル取得
2. Phase 7（Variant Calling）のみ実行
3. 合計時間: 2-4時間
4. 合計コスト: $51-101

**ユースケース**:
- 既存検出結果に変異解析を追加
- 特定病原体の詳細解析
- **研究目的の追加解析に最適**

---

### 4.4 変異検出パイプライン追加実装案

#### 4.4.1 必要な入力データ

| ツール | FAST5必要 | FASTQ必要 | BAM必要 | リファレンス必要 |
|-------|---------|---------|---------|---------------|
| **Medaka** | ❌ | ✅ | ✅ | ✅ |
| **Clair3** | ❌ | ✅ | ✅ | ✅ |
| **Nanopolish** | ✅ | ✅ | ✅ | ✅ |
| **Longshot** | ❌ | ❌ | ✅ | ✅ |

**重要な発見**: **MedakaとClair3はFAST5不要** → FASTQとBAMのみで変異検出可能

#### 4.4.2 Phase 7実装の概要

**新規Lambda関数**: `lambda/phases/trigger_variant_calling.py`

**新規スクリプト**: `scripts/phase7_variants/call_variants.sh`

**処理内容**:
1. 検出された病原体リスト取得
2. 各病原体についてMedaka variant calling実行
3. VCFフィルタリング（QUAL≥20、DP≥10）
4. SNP/indel別に分割
5. 変異アノテーション（DBがある場合）
6. 統合レポート生成

**追加コスト**:
- 処理時間: +2-4時間/サンプル
- 計算コスト: +$50-100/サンプル

---

### 4.5 データ保持期間の最適化提案

#### 4.5.1 改善提案

```yaml
data_retention:
  raw_data_days: 30          # FAST5（変更なし、Deep Archiveへ）
  processed_data_days: 365   # FASTQ/BAM（90 → 365日に延長）★
  reports_days: 365          # レポート（変更なし）
  database_records_days: 730 # DB記録（変更なし）
```

**効果**:
- **メリット**: 1年以内の再解析が即座に可能（取得待ち時間なし）
- **追加コスト**: 約$25-30/サンプル/年
- **年間24サンプル**: $600-720/年の追加コスト

**推奨**: 研究フェーズは365日保持、運用安定後に90日に戻す選択肢も検討。

---

### 4.6 再解析のコスト比較

**シナリオ**: 1年後に再解析

| アプローチ | データソース | 取得時間 | 計算時間 | 合計コスト | 合計時間 |
|-----------|------------|---------|---------|----------|---------|
| **FAST5完全再解析** | Deep Archive | 12時間 | 24-35時間 | **$401-501** | 36-47時間 |
| **FASTQ部分再解析** | Glacier IR | 1-3時間 | 8-12時間 | **$150-250** | 9-15時間 |
| **FASTQ即時再解析**（365日保持） | Standard | 即時 | 8-12時間 | **$150-250** | 8-12時間 |
| **BAM変異検出のみ** | Glacier IR | 1時間 | 2-4時間 | **$50-100** | 3-5時間 |
| **BAM即時変異検出**（365日保持） | Standard | 即時 | 2-4時間 | **$50-100** | 2-4時間 |

---

## 5. 血漿量要件と検出感度

### 5.1 標準血漿量要件

**推奨血漿量**: **5-10 mL/解析**

---

### 5.2 レベル別要件

| レベル | 血漿量 | 用途 | cfDNA収量 | cfRNA収量 | LOD達成 |
|--------|-------|------|-----------|-----------|---------|
| **最小許容** | 5 mL | 単回解析 | 50-100 ng | 20-50 ng | 50-100 copies/mL |
| **標準/推奨** | 5-10 mL | DNA+RNA抽出 | 100-500 ng | 30-150 ng | 25-50 copies/mL |
| **最適** | 10-15 mL | デュプレックス+複製 | 200-800 ng | 50-200 ng | 10-25 copies/mL |
| **拡張** | 15-20 mL | 複数解析+バックアップ | 300-1000 ng | 80-300 ng | <10 copies/mL |

---

### 5.3 採血から血漿までのプロセス

#### 5.3.1 血液採取

```
採血量: 5-10 mL × 2本 = 10-20 mL全血
採血管: EDTA-2K（推奨：Streck Cell-Free DNA BCT）
針サイズ: ≤21G（溶血防止）
```

#### 5.3.2 血漿分離

**2段階遠心分離**（必須）:

```
【1次遠心】
条件: 1,500-1,600×g、10分、4°C
目的: 血球と血漿の分離

【2次遠心】
条件: 16,000×g、10分、4°C（★必須）
目的: 残存血小板・細胞破片の除去

血漿回収率: 50-60%
10 mL全血 → 5-6 mL血漿
```

**タイミング**: 採血後30分以内に遠心（理想：15分以内）

---

### 5.4 血漿量と収量の関係

**Zymo Quick-cfDNA/cfRNA Kit性能**:

| 血漿入力量 | cfDNA収量（平均） | cfRNA収量（平均） | DNA濃度 | RNA濃度 |
|-----------|-----------------|-----------------|---------|---------|
| 1.5 mL | 15-30 ng（20 ng） | 5-15 ng（10 ng） | 0.4 ng/μL | 0.3 ng/μL |
| **5 mL** | **50-100 ng（75 ng）** | **20-50 ng（35 ng）** | **1.5 ng/μL** | **1.2 ng/μL** |
| **10 mL** | **100-500 ng（300 ng）** | **30-150 ng（90 ng）** | **6 ng/μL** | **3 ng/μL** |
| 15 mL | 150-750 ng（450 ng） | 45-225 ng（135 ng） | 9 ng/μL | 4.5 ng/μL |

**溶出容量**: DNA 50 μL、RNA 30 μL

---

### 5.5 QC合格基準

#### DNA要件（5 mL血漿使用時）

| メトリクス | 最小値 | 合格範囲 | 最適 | 不合格 | アクション |
|-----------|--------|---------|------|--------|----------|
| 総DNA量 | 10 ng | 50-100 ng | >100 ng | <5 ng | 新規サンプルまたは10 mL使用 |
| DNA濃度 | 2 ng/μL | 10-20 ng/μL | >20 ng/μL | <1 ng/μL | 複数抽出プール |
| A260/A280 | 1.7 | 1.8-2.0 | 1.9-2.0 | <1.6, >2.2 | タンパク質/塩混入チェック |
| A260/A230 | 1.8 | 2.0-2.2 | 2.1-2.2 | <1.5 | 有機溶媒混入チェック |

#### RNA要件（5 mL血漿使用時）

| メトリクス | 最小値 | 合格範囲 | 最適 | 不合格 | アクション |
|-----------|--------|---------|------|--------|----------|
| 総RNA量 | 5 ng | 20-50 ng | >50 ng | <2 ng | 新規サンプル必須 |
| RNA濃度 | 1 ng/μL | 5-10 ng/μL | >10 ng/μL | <0.5 ng/μL | RNaseフリー技術確認 |

**低収量時の対応**:

```
DNA 10-50 ng: 許容可能だが複数サンプルプール推奨
DNA 5-10 ng: 2回抽出してプールまたは10 mLに増量
DNA <5 ng: 不合格、新規サンプル採取必須
RNA <5 ng: 不合格、新規サンプル採取必須
```

---

### 5.6 血漿量と検出感度（LOD）の関係

#### 5.6.1 血漿量別LOD

| 血漿量 | 抽出DNA総量 | 宿主除去後 | 病原体濃縮係数 | 理論LOD | 実測LOD |
|--------|-----------|-----------|--------------|---------|---------|
| 2.5 mL | 25-50 ng | 1-2 ng | 5× | 100-200 copies/mL | 150-300 copies/mL |
| **5 mL** | **50-100 ng** | **2-5 ng** | **10×** | **50-100 copies/mL** | **75-150 copies/mL** |
| **10 mL** | **100-500 ng** | **5-25 ng** | **20×** | **25-50 copies/mL** | **40-80 copies/mL** |
| 15 mL | 150-750 ng | 7-38 ng | 30× | 15-35 copies/mL | 25-50 copies/mL |

**PMDA目標LOD**: 50-100 copies/mL（全91病原体）→ **達成血漿量**: 5-10 mL

---

### 5.7 血漿量最適化の考慮事項

#### 5.7.1 感度向上の3つの戦略

**優先順位**:

```
【1位】宿主DNA除去（主要戦略）
効果: 10倍濃縮（0.1% → 1%病原体割合）
コスト: $5/サンプル
実装: 実装済み

【2位】血漿量増加（補助戦略）
効果: 2倍濃縮（5 mL → 10 mL）
コスト: 追加血漿採取（ほぼゼロ）
実装: 実装済み

【3位】Duplexシーケンシング（精度戦略）
効果: Q20 → Q30（偽陽性削減）
コスト: 実行時間1.5倍
実装: 実装済み
```

---

### 5.8 PERV検出の特別要件

| 項目 | 要件 | 理由 |
|------|------|------|
| **血漿量** | 標準5-10 mL | 通常は高コピー数（1,000-100,000 copies/mL） |
| **DNA + RNA抽出** | 両方必須 | DNA（組込み型）+ RNA（活性転写） |
| **型別の最小量** | 5 mL最小 | 全長8-9 kbゲノム回収に必要 |
| **定量精度** | 10 mL推奨 | Duplexシーケンシングで正確な定量 |

**PERVコピー数カテゴリーと臨床判断**:

| コピー数/mL | 評価 | アクション |
|-----------|------|----------|
| <50 | 検出限界以下 | 再検査（理論上まれ） |
| 50-1,000 | 低コピー | モニタリング継続 |
| 1,000-10,000 | 中コピー | 許容範囲、定期検査 |
| 10,000-100,000 | 高コピー | 注意、獣医師レビュー |
| >100,000 | 超高コピー | **隔離、異種移植不適** |

---

### 5.9 トラブルシューティング

| 問題 | 考えられる原因 | 解決策 |
|------|--------------|--------|
| **DNA <10 ng（5 mLから）** | サンプル中cfDNA濃度が低い | ① 10 mL血漿使用<br/>② 2回抽出してプール<br/>③ 新規サンプル採取 |
| **RNA <5 ng（5 mLから）** | cfRNA分解またはRNase混入 | ① 新鮮サンプル使用<br/>② RNaseフリー技術徹底<br/>③ 10 mL血漿使用 |
| **病原体検出不可（陽性予想）** | 不十分な血漿量または低コピー | ① 血漿量を10-15 mLに増量<br/>② シーケンシング深度増加<br/>③ 異なる時点で再サンプリング |
| **溶血が明らか（赤色血漿）** | 採血技術の問題 | ① 細い針使用（<21G）<br/>② 新規サンプル採取必須 |
| **>6 mL血漿回収（良好）** | 適切な採血・遠心 | DNA 5 mL + RNA 5 mL + バックアップ 1 mL で最適利用 |

---

## 6. 推奨事項と今後の展開

### 6.1 即座に実施すべき改善

#### 6.1.1 データ保持期間延長

**推奨変更**:
```yaml
processed_data_days: 90 → 365
```

**理由**:
- 変異検出パイプライン開発時の反復テストが容易
- 1年以内の研究的再解析の機動性向上
- Deep Archive取得待ち時間（12時間）の回避

**追加コスト**: 約$600-720/年（24サンプル）

#### 6.1.2 再解析CLIコマンド実装

**新規コマンド**:
```bash
./tools/workflow_cli.py reanalyze \
  --run-id RUN-2024-001 \
  --from-phase bam \
  --enable-variants
```

**機能**:
- BAM/FASTQからの再解析開始
- 変異検出の有効/無効選択
- 特定病原体のみ解析

---

### 6.2 中期的実装（Phase 7: Variant Calling）

#### 6.2.1 実装範囲

**ステップ1: PERV変異検出（優先度：高）**
- Medakaインストール・設定
- PERV-A/B/C SNP/indel検出
- VCFファイル生成
- 変異アノテーション

**ステップ2: 全病原体への拡張（優先度：中）**
- Clair3実装（深層学習変異検出）
- 91病原体リファレンス変異データベース構築
- クレード/系統型別実装

**ステップ3: シグナルレベル解析（優先度：低）**
- Nanopolishインストール（FAST5必要）
- メチル化解析（現在無効化されている機能）

#### 6.2.2 開発コスト見積もり

| 項目 | コスト |
|------|--------|
| **開発**: Medaka/Clair3統合 | ¥500,000-1,000,000（1回のみ） |
| **DB構築**: 変異アノテーションDB | ¥1,000,000-2,000,000（1回のみ） |
| **年間運用** (24サンプル) | $1,320-2,640 + 人件費 |

---

### 6.3 長期的展望

#### 6.3.1 リファレンスデータベースのバージョン管理強化

**現状の課題**:
- PMDAデータベースが自動更新（`auto_update: true`）
- 完全な再現性には明示的なスナップショット必要

**推奨実装**:
- EFSスナップショット自動取得（解析実行時）
- データベースバージョンをメタデータに記録
- 過去のDBバージョンで再解析可能

#### 6.3.2 変異検出の臨床応用

**研究目的からの移行**:
1. PERV薬剤耐性変異の同定
2. 異種移植リスク評価への変異情報活用
3. PMDA規制要件への変異検出追加の可能性評価

---

### 6.4 コスト・時間まとめ

**現行パイプライン（変異検出なし）**:
- 処理時間: 20-35時間
- コスト: $150-250/サンプル
- 年間24サンプル: $3,600-6,000

**Phase 7追加後（変異検出あり）**:
- 処理時間: 24-40時間（+4-5時間）
- コスト: $200-350/サンプル（+$50-100）
- 年間24サンプル: $4,800-8,400（+$1,200-2,400）

**データ保持期間延長（365日）**:
- 追加コスト: $600-720/年
- メリット: 即座の再解析、開発の機動性向上

**総合投資**:
- 初期開発: ¥1,500,000-3,000,000
- 年間運用増加: $1,800-3,120（現行比）

---

## 結論

このMinION病原体スクリーニングパイプラインは、**ショットガンメタゲノミクス**を採用した**PMDA準拠の本番稼働グレードシステム**です。

**主要な発見**:

1. **前処理戦略**: PCR増幅なし、病原体別処理なし、キャプチャプローブなしの**ユニバーサルアプローチ**
2. **91病原体検出**: 4つの並列検出システム（Kraken2、BLAST、PMDA、PERV特異的）
3. **変異検出**: 現在は無効化だが、**FASTQとBAMから追加実装可能**
4. **データ保持**: 5年間保持、**再解析は完全に実現可能**
5. **血漿量**: 5-10 mL標準で50-100 copies/mL LOD達成

**今後の展開**:
- データ保持期間を90日→365日に延長（推奨）
- Phase 7（変異検出）の段階的実装
- 再解析CLIコマンドの追加
- リファレンスDBバージョン管理の強化

このシステムは、**異種移植の安全性確保**という重要な役割を果たしつつ、**研究的拡張性**も兼ね備えた設計となっています。

---

**文書作成**: 2025年11月10日
**調査範囲**: サンプル前処理、パイプラインアーキテクチャ、変異検出、データ保持、血漿量要件
**総ページ数**: 約80ページ相当
